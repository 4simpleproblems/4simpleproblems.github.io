<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4SP - Firebase Messenger</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="../firebase-config.js"></script>
    <script src="../ban-enforcer.js"></script>
    <script src="../panic-key.js"></script>
    <script src="../url-changer.js"></script>

    <style>
        :root {
            --v4-bg-gradient: linear-gradient(135deg, #f0f2f5 0%, #e8eaf0 100%);
            --v4-card-bg: #fff;
            --v4-text-primary: #333;
            --v4-text-secondary: #555;
            --v4-purple-accent: #6720bd;
            --v4-purple-accent-darker: #5a1aa8;
            --v4-purple-gradient: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%);
            --v4-border-light: #ddd;
            --v4-border-softer: #eee;
            --v4-input-bg: #f8f9fa;
            --v4-input-border: #ccc;
            --v4-font-primary: 'PrimaryFont', sans-serif;
            --v4-font-secondary: 'SecondaryFont', sans-serif;
        }
        .hidden { display: none !important; }
        body { display: flex; flex-direction: column; min-height: 100vh; margin: 0; font-family: var(--v4-font-primary); background: var(--v4-bg-gradient); color: var(--v4-text-primary); line-height: 1.6; }
        .notes-container-wrapper { display: flex; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 200px; background: linear-gradient(180deg, #333 0%, #2a2a2a 100%); color: #fff; padding: 20px 10px; display: flex; flex-direction: column; border-right: 1px solid #444; transition: width 0.5s ease-in-out; position: relative; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .sidebar.collapsed { width: 85px; }
        #toggleSidebar { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: none; border: none; color: #fff; font-size: 1.2em; cursor: pointer; padding: 4px; transition: transform 0.5s ease-in-out; }
        .sidebar.collapsed #toggleSidebar { transform: translateX(-50%) rotate(180deg); }
        .sidebar nav ul { list-style: none; padding: 0; margin: 60px 0 0; }
        .sidebar nav li { margin-bottom: 10px; }
        .sidebar nav a { display: flex; align-items: center; padding: 12px 15px; color: #fff; text-decoration: none; border-radius: 8px; transition: all 0.3s ease; font-family: var(--v4-font-primary); text-transform: uppercase; }
        .sidebar nav a.active, .sidebar nav a:hover { background: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%); transform: translateX(5px); }
        .sidebar nav a .icon { font-size: 1.2em; width: 24px; text-align: center; }
        .sidebar nav a .label { 
            margin-left: 10px; 
            white-space: nowrap; 
            opacity: 1;
            visibility: visible;
            transition: opacity 0.2s ease-in-out;
            transition-delay: 0.4s;
        }
        .sidebar.collapsed nav a .label { 
            opacity: 0;
            visibility: hidden;
            transition-delay: 0s;
        }

        .main-notes-content { flex: 1; padding: 30px; background: var(--v4-bg-gradient); overflow-y: auto; display: flex; flex-direction: column; padding-bottom: 120px; }
        .notes-header-v4 { margin-bottom: 25px; background: var(--v4-card-bg); padding: 20px 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .notes-title-v4 { font-size: 2.2em; font-weight: bold; background: var(--v4-purple-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; }
        
        /* --- DISCLAIMER STYLES --- */
        .disclaimer-banner {
            background-color: #cce5ff;
            color: #004085;
            border: 1px solid #b8daff;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 0.95em;
            line-height: 1.6;
        }
        .disclaimer-banner strong {
            font-weight: bold;
        }
        .privacy-banner {
            background-color: #d1e7dd; /* Light green */
            color: #0f5132; /* Dark green text */
            border: 1px solid #badbcc;
            border-radius: 10px;
            padding: 15px 20px;
            margin-top: 25px;
            text-align: center;
            font-size: 0.95em;
            line-height: 1.6;
        }
        .privacy-banner strong {
            font-weight: bold;
        }
        /* --- END DISCLAIMER STYLES --- */

        #editor-container { background: var(--v4-card-bg); padding: 25px; border-radius: 15px; box-shadow: 0 6px 30px rgba(0,0,0,0.08); }
        #editor-container ol { padding-left: 25px; font-size: 1.1em; line-height: 1.8; }
        #editor-container li { margin-bottom: 15px; }
        #editor-actions { display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-top: 15px; }

        .btn-primary { background: var(--v4-purple-gradient); color: white !important; text-decoration: none; border: none; padding: 14px 24px; border-radius: 10px; font-family: var(--v4-font-primary); text-transform: uppercase; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: inline-block;}
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(103, 32, 189, 0.4); }
        
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 2000; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; display: flex; align-items: center; justify-content: center; }
        .modal-backdrop.visible { opacity: 1; pointer-events: auto; }
        .modal-content { background: var(--v4-card-bg); width: 90%; max-width: 800px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: flex; flex-direction: column; max-height: 90vh; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.visible .modal-content { transform: scale(1); }
        code {
            font-style: italic;
            font-family: inherit;
        }

    </style>
</head>
<body class="notes-page">

    <header class="main-header light-bg">
        <div class="container">
            <div class="logo"><a href="../index.html"><img src="../images/logo-dark.png" alt="4SP Logo" style="cursor:pointer;"/></a></div>
            <div class="auth-buttons">
                <button class="btn btn-login" onclick="window.location.href='../index.html'">HOME</button>
                <button id="logoutBtn" class="btn btn-login">LOG OUT</button>
            </div>
        </div>
    </header>

    <div class="notes-container-wrapper">
        <aside class="sidebar slide-in" id="sidebar">
            <button id="toggleSidebar">‚ò∞</button>
            <nav>
                <ul>
                    <li><a href="dashboard.html"><span class="icon">üè†</span><span class="label">Dashboard</span></a></li>
                    <li><a href="soundboard.html"><span class="icon">üéµ</span><span class="label">Soundboard</span></a></li>
                    <li><a href="games.html"><span class="icon">üéÆ</span><span class="label">Games</span></a></li>
        <li><a href="apps.html" class="active"><span class="icon">‚ú®</span><span class="label">Apps</span></a></li>
                    <li><a href="settings.html"><span class="icon">‚öôÔ∏è</span><span class="label">Settings</span></a></li>
                    <li><a href="#" id="signOutLink"><span class="icon">üîí</span><span class="label">LOG OUT</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-notes-content">
            <div class="notes-header-v4"> <h2 class="notes-title-v4">Firebase Messenger App üí¨</h2> </div>
            
            <div class="disclaimer-banner">
                <strong>Powered by Firebase:</strong> This messenger is now internet-based. You can message anyone who has the app, regardless of their WiFi network.
            </div>

            <div id="editor-container">
                <h3>Instructions:</h3>
                <ol>
                    <li>Click the "Download App" button below to save the <code>messenger.html</code> file to your Chromebook.</li>
                    <li>Open the "Files" app on your Chromebook and go to your "Downloads" folder.</li>
                    <li>To start the app, double-click the <code>messenger.html</code> file you just downloaded.</li>
                    <li>The app will give you an 8-character long ID. Share this ID with your friends so they can add you as a contact!</li>
                </ol>
                <div id="editor-actions">
                    <a href="../logged-in/messenger.html" download="messenger.html" class="btn-primary">Download App</a>
                </div>
            </div>

            <div class="privacy-banner">
                <strong>üîí Secure Messaging:</strong> Your messages are handled by a secure Firebase database. Only you and the person you are chatting with can read the messages for your conversation.
            </div>
            
            <div id="notesView">
                </div>
        </main>
    </div>

    <div id="noteModal" class="modal-backdrop">
        </div>
    <div id="importModal" class="modal-backdrop">
        </div>
    <div id="exportModal" class="modal-backdrop">
        </div>

    <script>
    // --- AUTH & BASIC UI ---
    const dbRef_ = () => firebase.firestore().collection('users').doc(firebase.auth().currentUser.uid);
    firebase.auth().onAuthStateChanged(async user => { if (!user) { window.location.href = '../login.html'; } });
    document.getElementById('logoutBtn')?.addEventListener('click', () => { firebase.auth().signOut().then(() => { window.location.href = '../login.html'; }); });
    document.getElementById('signOutLink')?.addEventListener('click', (e) => { e.preventDefault(); firebase.auth().signOut().then(() => { window.location.href = '../login.html'; }); });
    const sidebar_ = document.getElementById('sidebar');
    const toggleSidebarBtn_ = document.getElementById('toggleSidebar');
    if (toggleSidebarBtn_ && sidebar_) { toggleSidebarBtn_.addEventListener('click', () => { sidebar_.classList.toggle('collapsed'); }); }
    </script>
</body>
</html>
